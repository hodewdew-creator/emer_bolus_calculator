<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>응급 약물 용량 계산기</title>
  <style>
    :root{ --blue:#1d4ed8; --lightblue:#dbeafe; --muted:#64748b; --bg:#f8fafc; --card:#fff; --border:#e5e7eb; }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:#0f172a;padding:12px}
    h2{margin:0 0 10px;font-size:1.28rem;color:var(--blue);text-align:center}

    /* 공통 카드/레이아웃 (NE CRI와 통일) */
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:10px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:stretch}
    .ibox{border:2px solid var(--blue);border-radius:10px;padding:8px;background:#f9fafb;min-width:160px;flex:1;display:flex;flex-direction:column;justify-content:flex-start;position:relative}
    label{display:block;font-size:.86rem;color:var(--blue);margin-bottom:4px}

    /* 입력 박스 (박스 크기 유지, 안의 글자만 크게) */
    input[type=number]{width:100%;height:38px;padding:6px 10px;border:1px solid var(--border);border-radius:8px;background:#fff;font-size:1.2rem;font-weight:700;text-align:center}
    input[type=number]:focus{outline:none;border-color:var(--blue)}
    .dose-input{width:80px;height:34px;padding:4px 6px;border:1px solid var(--border);border-radius:8px;background:#fff;font-size:1.15rem;font-weight:800;text-align:center;color:#0f172a}

    /* 상단 컨트롤 */
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{padding:8px 10px;border:1px solid var(--border);background:#fff;border-radius:10px;cursor:pointer;font-size:.95rem;position:relative}
    .btn small{display:block;font-size:0.7rem;color:var(--muted);margin-top:2px}
    .btn:active{transform:translateY(1px)}

    /* 결과 리스트: 두 열 그리드로 정보 밀집 */
    .drugs{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
    @media (max-width:520px){ .drugs{grid-template-columns:1fr} }

    .drug{border:1px solid var(--border);border-radius:10px;padding:6px 8px;background:#fff}
    .drug-header{display:flex;justify-content:space-between;align-items:center;gap:6px}
    .name{font-weight:700}
    .result{color:#1e3a8a;font-weight:800}
    .meta{font-size:.86rem;color:#374151}
    .bar{grid-column:1/-1;border-top:2px solid #d1d5db;margin:2px 0}

    .details{display:none;margin-top:4px;font-size:.85rem;color:#111}
    .details.show{display:block}

    /* 접힘 상태일 때 수직 여백 최소화 */
    .collapsed .drug{padding:4px 6px}
  </style>
</head>
<body>
  <h2>⚡ 응급 약물 용량 계산기</h2>

  <div class="card">
    <div class="controls row">
      <div class="ibox" style="max-width:220px">
        <label for="weight">체중 (kg)</label>
        <input type="number" id="weight" value="1" min="0.1" step="0.1" onchange="calc()" />
      </div>
      <button id="toggleDetails" class="btn" onclick="toggleDetails()" aria-pressed="false">
        <span id="btnText">계산 열기</span>
        <small>dose 조절 가능</small>
      </button>
    </div>
  </div>

  <div class="card">
    <div id="results" class="drugs"></div>
  </div>

  <script>
    const drugs = [
      {name:"Glycopyrrolate", conc:0.2, dose:0.011, unit:"mg", vol:"mL", rangeMin:0.011, rangeMax:0.033, route:"iv/im/sc"},
      {name:"Atropine", conc:0.5, dose:0.02, unit:"mg", vol:"mL", rangeMin:0.02, rangeMax:0.04, route:"iv/im/sc"},
      {name:"Epinephrine (low,q4m)", conc:1, dose:0.01, unit:"mg", vol:"mL", rangeMin:0.01, rangeMax:0.02, route:"iv/im/et"},
      {name:"Epinephrine (high,dilute 1:1)", conc:1, dose:0.1, unit:"mg", vol:"mL", rangeMin:0.1, rangeMax:0.2, route:"iv/im/et"},
      {bar:true},
      {name:"Midazolam", conc:5, dose:0.1, unit:"mg", vol:"mL", rangeMin:0.1, rangeMax:0.3, route:"iv/im/in"},
      {name:"Diazepam", conc:5, dose:0.2, unit:"mg", vol:"mL", rangeMin:0.1, rangeMax:0.5, route:"iv/pr"},
      {name:"Fentanyl", conc:50, dose:5, unit:"µg", vol:"mL", rangeMin:2, rangeMax:10, route:"iv/cri"},
      {name:"Naloxone", conc:0.4, dose:0.01, unit:"mg", vol:"mL", rangeMin:0.01, rangeMax:0.01, route:"iv/im/sc"},
      {bar:true},
      {name:"Xylazine (emetic)", conc:23.32, dose:0.44, unit:"mg", vol:"mL", rangeMin:0.5, rangeMax:1.0, route:"im"},
      {name:"Yohimbine", conc:10, dose:0.1, unit:"mg", vol:"mL", rangeMin:0.1, rangeMax:0.2, route:"iv"},
      {bar:true},
      {name:"Dexamethasone-SP", conc:5, dose:0.1, unit:"mg", vol:"mL", rangeMin:0.1, rangeMax:0.5, route:"iv/im"},
      {name:"Sodium Bicarbonate", conc:1, dose:1, unit:"mEq", vol:"mL", rangeMin:1, rangeMax:2, route:"iv slow"},
      {name:"Calcium Gluconate", conc:9.3, dose:15, unit:"mg", vol:"mL", rangeMin:5, rangeMax:15, route:"iv slow"},
      {name:"Magnesium sulfate", conc:100, dose:null, unit:"mg", vol:"mL", rangeMin:37, rangeMax:75, route:"iv slow", displayUnit:"mg (from g)"},
      {name:"Dextrose 50%", conc:0.5, dose:0.5, unit:"g", vol:"mL", rangeMin:0.5, rangeMax:1, route:"iv diluted"},
      {bar:true},
      {name:"Mannitol 20%", conc:200, dose:500, unit:"mg", vol:"g/mL", rangeMin:250, rangeMax:1000, route:"iv over 15–30min"},
      {name:"Hetastarch", conc:null, dose:15, unit:"mL", vol:"mL", rangeMin:10, rangeMax:20, route:"iv slow"}
    ];

    let expanded = false; // 기본: 접힘

    function setCollapsedClass(){
      document.body.classList.toggle('collapsed', !expanded);
    }

    function toggleDetails(){
      expanded = !expanded;
      const btnText = document.getElementById('btnText');
      btnText.textContent = expanded ? '계산 닫기' : '계산 열기';
      const btn = document.getElementById('toggleDetails');
      btn.setAttribute('aria-pressed', expanded);
      setCollapsedClass();
      calc();
    }

    function drugCardHTML(d, i, w){
      if(d.bar){ return '<div class="bar"></div>'; }

      const doseInputId = `dose-${i}`;
      const step = ((d.rangeMax - d.rangeMin) / 10).toFixed(3);
      const chosenDoseEl = document.getElementById(doseInputId);
      const chosenDose = parseFloat(chosenDoseEl ? chosenDoseEl.value : d.dose);

      let volume;
      if(d.conc && chosenDose){
        volume = ((chosenDose * w) / d.conc).toFixed(2);
      } else if(d.name === 'Hetastarch'){
        volume = (chosenDose * w).toFixed(2);
      } else {
        volume = '-';
      }

      const detailsCls = expanded ? 'details show' : 'details';

      return `
        <div class="drug">
          <div class="drug-header">
            <div class="name">💉 ${d.name}</div>
            <div class="result">${volume} ${d.vol}</div>
          </div>
          <div class="${detailsCls}">
            <div class="meta">
              ${d.conc ? `${d.conc} ${d.unit}/mL` : ''}
              · <span class='range'>${d.rangeMin}–${d.rangeMax} ${d.unit}/kg</span>
              · <span class='route' style="font-style:italic; text-transform:lowercase; color:#6b7280">${d.route}</span>
            </div>
            <div style="margin-top:4px">
              <span class="dose-label" style="color:#b91c1c;font-weight:700">Dose</span>
              <input type='number' class='dose-input' id='${doseInputId}' value='${d.dose}' min='${d.rangeMin}' max='${d.rangeMax}' step='${step}' onchange='calc()'> ${d.unit}/kg
            </div>
          </div>
        </div>`;
    }

    function calc(){
      const w = parseFloat(document.getElementById('weight').value);
      let html = '';
      drugs.forEach((d,i)=>{ html += drugCardHTML(d,i,w); });
      document.getElementById('results').innerHTML = html;
    }

    // 초기 상태 반영
    setCollapsedClass();
    calc();
  </script>
</body>
</html>
